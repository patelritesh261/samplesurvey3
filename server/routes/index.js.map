{"version":3,"sources":["routes/index.ts"],"names":[],"mappings":"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","file":"routes/index.js","sourcesContent":["import express = require('express');\r\nvar sendgrid = require('sendgrid')('ACCOUNT_NAME', 'PASSWORD');\r\nimport passport = require('passport');\r\nvar router = express.Router();\r\n\r\n// db references\r\nimport userModel = require('../models/user');\r\nimport User = userModel.User;\r\n\r\nimport mcqModel = require('../models/multiple');\r\nimport Mcq = mcqModel.Mcq;\r\n\r\n/* GET home page. */\r\nrouter.get('/', (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('index', { \r\n        title: 'Home', \r\n        displayName: req.user ? req.user.displayName : '' });\r\n});\r\n\r\n/* GET product page. */\r\nrouter.get('/products', (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('index', { \r\n        title: 'Products',\r\n        displayName: req.user ? req.user.displayName : ''});\r\n});\r\n\r\n/* GET services page. */\r\nrouter.get('/services', (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('index', { \r\n        title: 'Services',\r\n        displayName: req.user ? req.user.displayName : '' });\r\n});\r\n\r\n/* GET about page. */\r\nrouter.get('/about', (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('about', { \r\n        title: 'About',\r\n        displayName: req.user ? req.user.displayName : '' });\r\n});\r\n\r\n/* GET about page. */\r\nrouter.get('/test', (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('test', { \r\n        title: 'About',\r\n        displayName: req.user ? req.user.displayName : '' });\r\n});\r\n\r\n/* GET contact page. */\r\nrouter.get('/contact', (req: express.Request, res: express.Response, next: any) => {\r\n    req.flash('successmessage', 'Thank You. Your message has been sent.');\r\n    req.flash('errormessage','An Error has occurred.');\r\n    res.render('contact', { \r\n        title: 'Contact', \r\n        messages: null,\r\n        displayName: req.user ? req.user.displayName : '' });\r\n});\r\n\r\n/* Email processing */\r\nrouter.post('/contact', (req: express.Request, res: express.Response, next: any) => {\r\n    \r\n    var sendgrid = require(\"sendgrid\")(\"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\");\r\nvar email = new sendgrid.Email();\r\n\r\nemail.addTo(\"patelritesh261@gmail.com\");\r\nemail.setFrom(req.body.email);\r\nemail.setSubject(\"Contact Form Submission\");\r\nemail.setHtml(\"<html><body><main><h2>HI \"+ req.body.name +\",</main><h4>This message has been sent from the contact form at Sample Surveysite</h4><table><tr><td>\"+\"Name: \" + req.body.name + \"</td></tr><tr><td>\"+ \"Phone: \" + req.body.phone + \"</td></tr><tr><td colspan=2>\"+\"Message : \"+ req.body.message+\"</td></tr></table>Thank you</body></html>\");\r\n//email.setHtml(\"/respond/\"+ss.displayName+\"/\"+ss.surveyType+\"/\"+ss.surveyName);\r\n\r\n\r\nsendgrid.send(email);\r\n   \r\n            res.render('contact', { \r\n                title: 'Contact',\r\n                messages: 'Thank you, we will contact as soon as possible.',\r\n                  displayName: req.user ? req.user.displayName : ''\r\n         });\r\n\r\n        \r\n});\r\n\r\n/* Render Login Page */\r\nrouter.get('/login', (req:express.Request, res: express.Response, next:any) => {\r\n    if(!req.user) {\r\n        res.render('login', {\r\n            title: 'Login',\r\n            messages: req.flash('loginMessage'),\r\n            displayName: req.user ? req.user.displayName : ''\r\n            // message : req.flash('error')\r\n        });\r\n        return;\r\n    } else {\r\n        return res.redirect('/users');\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n/* Process Login Request */\r\nrouter.post('/login', passport.authenticate('local', {\r\n    successRedirect: '/users',\r\n    failureRedirect: '/loginFailure',\r\n    failureFlash: true,\r\n    failureMessage: \"Invalid username or password\",\r\n    messages:\"Invalid username or password\"\r\n    \r\n}));\r\n\r\nrouter.get('/loginFailure', function(req, res, next) {\r\n    req.flash('loginMessage', 'Invalid UserName Or Password.');\r\n  res.redirect('/login');\r\n});\r\n\r\n\r\n\r\n/* Render Password Reset page */\r\nrouter.get('/reset', (req:express.Request, res: express.Response, next:any) => {\r\n    if(req.user) {\r\n        res.render('reset', {\r\n            title: 'Reset',\r\n            displayName: req.user ? req.user.displayName : '' \r\n        });  \r\n    }\r\n    else {\r\n        return res.redirect('/login');\r\n    }\r\n});\r\n\r\n/* Process Password Reset Request */\r\nrouter.post('/reset',(req:express.Request, res: express.Response, next:any) => {\r\n    console.log(req.user.username);\r\n    User.findOne({'username':req.user.username}, (err, user) => {\r\n       user.setPassword(req.body.password, (err) =>{\r\n          if(err) {\r\n              console.log(err);\r\n              next(err);\r\n          } else {\r\n              user.save((err) =>{\r\n                  if(err) {\r\n                      console.log(err);\r\n                  }\r\n                  \r\n                  console.log('Password Changed');\r\n                  res.redirect('/users');\r\n              });\r\n          }\r\n       }); \r\n    });\r\n});\r\n\r\n/* Render Registration page */\r\nrouter.get('/register', (req:express.Request, res: express.Response, next:any) => {\r\n    if(!req.user) {\r\n        res.render('register', {\r\n            title: 'Register',\r\n            messages: req.flash('registerMessage'),\r\n            displayName: req.user ? req.user.displayName : ''\r\n        });\r\n        return;\r\n    } else {\r\n        return res.redirect('/');\r\n    }\r\n});\r\n\r\n/* Process Registration Request */\r\nrouter.post('/register', (req:express.Request, res: express.Response, next:any) => {\r\n    // attempt to register user\r\n    User.register(new User(\r\n       { username: req.body.username,\r\n         password: req.body.password,\r\n         email: req.body.email,\r\n         displayName: req.body.displayName\r\n       }), req.body.password, (err) => {\r\n           if(err) {\r\n               console.log('Error Inserting New Data');\r\n               if(err.name == 'UserExistsError') {\r\n               req.flash('registerMessage', 'Registration Error: User Already Exists!');\r\n               }\r\n               return res.render('register', {\r\n                    title: 'Register',\r\n                    messages: req.flash('registerMessage'),\r\n                    displayName: req.user ? req.user.displayName : ''\r\n                });\r\n           }\r\n           // if registration is successful\r\n           return passport.authenticate('local')(req, res, ()=>{\r\n              res.redirect('/users'); \r\n           });\r\n       });\r\n});\r\n\r\n/* Process Logout Request */\r\nrouter.get('/logout', (req:express.Request, res: express.Response) => { \r\n    req.logOut();\r\n    res.redirect('/login');\r\n});\r\n\r\nmodule.exports = router;\r\n"],"sourceRoot":"/source/"}